# Supabase Setup Guide for One Motors

This guide will walk you through setting up your Supabase project correctly from scratch to work with the One Motors application.

Since SQL permissions can be tricky with managed services, we recommend using the Supabase Dashboard UI for most steps.

## Step 1: Create the 'cars' Table

This table stores all vehicle information. You can create it by running the following SQL in the **SQL Editor** of your Supabase Dashboard:

```sql
-- Create the 'cars' table
create table public.cars (
  id bigint generated by default as identity primary key,
  created_at timestamp with time zone default timezone('utc'::text, now()) not null,
  title text not null,
  brand text not null,
  model text not null,
  year integer not null,
  price numeric not null,
  mileage integer not null,
  fuel_type text not null,
  transmission text not null,
  body_type text not null,
  color text not null,
  description text,
  featured boolean default false,
  images text[] default '{}'::text[]
);

-- Enable Row Level Security (RLS)
alter table public.cars enable row level security;

-- Create policy to allow public read access (everyone can see cars)
create policy "Public cars are visible to everyone"
on public.cars for select
to public
using (true);

-- Create policy to allow public insert/update/delete (since we use a simple admin password)
-- WARNING: In a real production app with multiple users, you would restrict this to authenticated users only.
create policy "Public can modify cars"
on public.cars for all
to public
using (true)
with check (true);
```

**Instruction:** Copy the above SQL block, paste it into the Supabase SQL Editor, and click **Run**.

---

## Step 2: Create the 'car-images' Storage Bucket

This is where vehicle images will be uploaded.

1.  Go to the **Storage** section in the left sidebar (icon looks like a folder/box).
2.  Click **+ New Bucket**.
3.  **Name the bucket:** `car-images` (exactly this name).
4.  **Public bucket:** Toggle this to **ON** (make it green). This allows images to be viewed publicly.
5.  Click **Save**.

---

## Step 3: Configure Storage Policies (Crucial Step)

This step allows your application to upload images to the bucket.

1.  In the **Storage** section, click on your new `car-images` bucket.
2.  Click on the **Configuration** tab specifically for this bucket.
3.  Look for **Policies** or "RLS Policies".
4.  Click **New Policy** (or "Add Policy").
5.  Choose **"Get started quickly"** -> **"Give users access to all files"** (or select "For full customization").
6.  Ensure the following operations are selected/checked:
    - **SELECT** (Download)
    - **INSERT** (Upload)
    - **UPDATE**
    - **DELETE**
7.  Target roles: Select **anon** (and **authenticated** if available) or just check "Select all".
8.  Click **Review** and then **Save Policy**.

**Verification:**  
You should see a policy listed that says something like "Give users access to all files" or allows `INSERT`, `SELECT`, `UPDATE`, `DELETE` to `public` or `anon`.

---

## Step 4: Verify Environment Variables

Ensure your project is connected to this Supabase instance.
Check your `.env` file in the project root:

```env
VITE_SUPABASE_URL=your_project_url
VITE_SUPABASE_ANON_KEY=your_anon_key
```

Both should be populated from your Supabase Project Settings > API.

---

## Troubleshooting

If you still see "Bucket not found":

- Double-check the bucket name is exactly `car-images`.
- Refresh the page and try again.

If you see "Policy violation" or "Permission denied":

- Revisit **Step 3** and ensure the **INSERT** permission is granted to the `anon` (public) role.
